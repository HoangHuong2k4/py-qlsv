<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>5 Káº¿ Hoáº¡ch Há»c Táº­p - CTU</title>
  <link rel="stylesheet" href="/static/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
  <!-- Header Banner -->
  <div id="header">
    <div id="banner"></div>
  </div>

  <!-- Navigation Bar -->
  <nav class="navbar">
    <a href="/dashboard" class="nav-link">ğŸ  Dashboard</a>
    <a href="/study-plan" class="nav-link active">ğŸ“š Káº¿ hoáº¡ch há»c táº­p</a>
    <a href="/profile" class="nav-link">ğŸ‘¤ ThÃ´ng tin cÃ¡ nhÃ¢n</a>
    <a href="/logout" class="nav-link logout">ğŸšª ÄÄƒng xuáº¥t</a>
  </nav>

  <!-- Main Content -->
  <div class="container">
    <h1 style="color: #1f5ca9; margin-bottom: 0.5rem;">ğŸ“š 5 Káº¿ Hoáº¡ch Há»c Táº­p</h1>
    <p style="color: #666; margin-bottom: 2rem;">
      <em>{% if is_new_student %}Káº¿ hoáº¡ch Ä‘áº§y Ä‘á»§ tá»« HK1 nÄƒm 1 Ä‘áº¿n HK1 nÄƒm 5{% else %}Gá»£i Ã½ há»c pháº§n tiáº¿p theo Ä‘á»ƒ Ä‘á»§ 156 tÃ­n chá»‰{% endif %}</em>
    </p>
    
    {% for plan in plans %}
    <section class="card" style="border-left: 4px solid {{ plan.color }}; margin-bottom: 2rem;">
      <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
        <div style="flex: 1;">
          <h2 style="color: {{ plan.color }}; margin: 0;">{{ plan.name }}</h2>
          <p style="color: #666; margin-top: 0.5rem;">{{ plan.description }}</p>
          {% if distances %}
          <p style="color: #888; font-size: 0.9em; margin-top: 0.5rem;">
            ğŸ“ Khoáº£ng cÃ¡ch Ä‘áº¿n cluster: {{ "%.2f"|format(plan.distance) }}
          </p>
          {% endif %}
        </div>
        <a href="{{ url_for('download_plan_pdf', cluster_id=plan.cluster_id) }}" 
           class="btn" 
           style="background: {{ plan.color }}; margin-left: 1rem;">
          ğŸ“¥ Táº£i PDF
        </a>
      </div>
      
      <!-- ThÃ´ng tin tá»•ng quan -->
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem; padding: 1rem; background: #f5f5f5; border-radius: 8px;">
        <div>
          <strong>Tá»•ng tÃ­n chá»‰:</strong><br>
          <span style="font-size: 1.3em; color: {{ plan.color }}; font-weight: bold;">
            {{ plan.total_credits }} / {{ plan.target_credits }} TC
          </span>
        </div>
        {% if plan.avg_credits_per_semester %}
        <div>
          <strong>TB tÃ­n chá»‰/ká»³:</strong><br>
          <span style="font-size: 1.3em; color: {{ plan.color }}; font-weight: bold;">
            {{ plan.avg_credits_per_semester }} TC
          </span>
        </div>
        {% endif %}
        {% if plan.recommended_credits %}
        <div>
          <strong>Äá» xuáº¥t thÃªm:</strong><br>
          <span style="font-size: 1.3em; color: {{ plan.color }}; font-weight: bold;">
            {{ plan.recommended_credits }} TC
          </span>
        </div>
        {% endif %}
      </div>
      
      <!-- Biá»ƒu Ä‘á»“ tÃ­n chá»‰ theo há»c ká»³ -->
      {% if plan.semesters %}
      <div style="margin-bottom: 1.5rem;">
        <h3 style="color: {{ plan.color }}; margin-bottom: 1rem;">ğŸ“Š Biá»ƒu Ä‘á»“ tÃ­n chá»‰ theo há»c ká»³</h3>
        <canvas id="chart_{{ plan.cluster_id }}" style="max-height: 300px;"></canvas>
      </div>
      {% endif %}
      
      <!-- Chi tiáº¿t tá»«ng há»c ká»³ -->
      {% if plan.semesters %}
      <div style="margin-top: 1.5rem;">
        <h3 style="color: {{ plan.color }}; margin-bottom: 1rem;">ğŸ“š Chi tiáº¿t mÃ´n há»c theo há»c ká»³</h3>
        
        {% for key, semester_data in plan.semesters|dictsort %}
          {% set year = semester_data.year %}
          {% set semester = semester_data.semester %}
          {% set courses = semester_data.courses %}
          {% set semester_credits = courses|sum(attribute='Credits') if courses|sum(attribute='Credits') else 0 %}
        <div style="margin-bottom: 1.5rem; padding: 1rem; background: #fafafa; border-radius: 8px; border-left: 3px solid {{ plan.color }};">
          <h4 style="color: {{ plan.color }}; margin: 0 0 0.5rem 0;">
            NÄƒm {{ year }} - Há»c ká»³ {{ semester }}
            <span style="font-size: 0.8em; color: #666; font-weight: normal;">
              ({{ semester_credits }} TC)
            </span>
          </h4>
          
          <table style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr style="background: {{ plan.color }}; color: white;">
                <th style="padding: 0.5rem; text-align: left;">MÃ£ mÃ´n</th>
                <th style="padding: 0.5rem; text-align: left;">TÃªn mÃ´n há»c</th>
                <th style="padding: 0.5rem; text-align: center;">TÃ­n chá»‰</th>
                {% if not is_new_student %}
                <th style="padding: 0.5rem; text-align: center;">Äiá»ƒm</th>
                {% endif %}
              </tr>
            </thead>
            <tbody>
              {% for course in courses %}
              <tr style="border-bottom: 1px solid #ddd;">
                <td style="padding: 0.5rem;"><strong>{{ course.CourseCode }}</strong></td>
                <td style="padding: 0.5rem;">{{ course.CourseName }}</td>
                <td style="padding: 0.5rem; text-align: center;">{{ course.Credits or 0 }}</td>
                {% if not is_new_student %}
                <td style="padding: 0.5rem; text-align: center;">{{ course.Score or '-' }}</td>
                {% endif %}
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <p style="color: #999; font-style: italic;">ChÆ°a cÃ³ dá»¯ liá»‡u káº¿ hoáº¡ch cho cluster nÃ y.</p>
      {% endif %}
    </section>
    {% endfor %}
    
    <section class="card" style="background-color: #fff3cd; border-left: 4px solid #FF9800;">
      <h3 style="color: #FF9800; margin-top: 0;"><i class="fas fa-lightbulb"></i> LÆ°u Ã½ quan trá»ng</h3>
      <ul style="margin: 0; padding-left: 1.5rem; color: #333;">
        <li style="margin: 0.5rem 0;">CÃ¡c káº¿ hoáº¡ch trÃªn Ä‘Æ°á»£c táº¡o dá»±a trÃªn K-Means Clustering (5 nhÃ³m sinh viÃªn)</li>
        <li style="margin: 0.5rem 0;">Káº¿ hoáº¡ch Ä‘Æ°á»£c sáº¯p xáº¿p theo khoáº£ng cÃ¡ch gáº§n nháº¥t Ä‘áº¿n mÃ´ hÃ¬nh há»c táº­p cá»§a báº¡n</li>
        <li style="margin: 0.5rem 0;">Báº¡n cÃ³ thá»ƒ Ä‘iá»u chá»‰nh linh hoáº¡t theo tÃ¬nh hÃ¬nh thá»±c táº¿</li>
        <li style="margin: 0.5rem 0;">Tham kháº£o Ã½ kiáº¿n cá»‘ váº¥n há»c táº­p trÆ°á»›c khi quyáº¿t Ä‘á»‹nh</li>
        <li style="margin: 0.5rem 0;"><strong>Tá»•ng tÃ­n chá»‰ tá»‘t nghiá»‡p: 156 TC</strong></li>
      </ul>
    </section>
    
    <div style="text-align: center; margin: 2rem 0;">
      <a href="/dashboard" class="btn" style="background: #1f5ca9; padding: 0.75rem 2rem;">
        <i class="fas fa-arrow-left"></i> Quay láº¡i Dashboard
      </a>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-content">
      <p><strong>TrÆ°á»ng Äáº¡i há»c Cáº§n ThÆ¡ (Can Tho University)</strong></p>
      <p>Khu II, Ä‘Æ°á»ng 3/2, P. XuÃ¢n KhÃ¡nh, Q. Ninh Kiá»u, TP. Cáº§n ThÆ¡.</p>
      <p>Äiá»‡n thoáº¡i: (84-292) 3832663 - (84-292) 3838474; Fax: (84-292) 3838474; Email: dhct@ctu.edu.vn.</p>
    </div>
  </footer>
  
  <script>
    // Táº¡o biá»ƒu Ä‘á»“ cho má»—i káº¿ hoáº¡ch
    {% for plan in plans %}
    {% if plan.semesters %}
    (function() {
      const ctx = document.getElementById('chart_{{ plan.cluster_id }}');
      if (!ctx) return;
      
      const semesterData = {};
      const semesterLabels = [];
      {% for key, semester_data in plan.semesters|dictsort %}
        {% set year = semester_data.year %}
        {% set semester = semester_data.semester %}
        {% set courses = semester_data.courses %}
        const chartKey = 'NÄƒm {{ year }} HK{{ semester }}';
        semesterLabels.push(chartKey);
        {% set sem_credits = courses|sum(attribute='Credits') if courses|sum(attribute='Credits') else 0 %}
        semesterData[chartKey] = {{ sem_credits }};
      {% endfor %}
      
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: semesterLabels,
          datasets: [{
            label: 'TÃ­n chá»‰',
            data: Object.values(semesterData),
            backgroundColor: '{{ plan.color }}80',
            borderColor: '{{ plan.color }}',
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: {
              display: false
            },
            title: {
              display: true,
              text: 'PhÃ¢n bá»‘ tÃ­n chá»‰ theo há»c ká»³',
              font: { size: 14, weight: 'bold' }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Sá»‘ tÃ­n chá»‰'
              }
            },
            x: {
              title: {
                display: true,
                text: 'Há»c ká»³'
              }
            }
          }
        }
      });
    })();
    {% endif %}
    {% endfor %}
  </script>
</body>
</html>

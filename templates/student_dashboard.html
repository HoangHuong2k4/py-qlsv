<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dashboard sinh viÃªn</title>
  <link rel="stylesheet" href="/static/style.css">
  <link rel="stylesheet" href="/static/login.css">
</head>
<body>
  <!-- Header Banner -->
  <div id="header">
    <div id="banner"></div>
  </div>

  <!-- Navigation Tabs -->
  <div class="nav-tabs">
    <div class="nav-container">
      <a href="/study-plan" class="nav-tab">Káº¿ hoáº¡ch há»c táº­p</a>
      <a href="/dashboard" class="nav-tab active">Gá»£i Ã½ mÃ´n há»c</a>
      <a href="/profile" class="nav-tab">ThÃ´ng tin cÃ¡ nhÃ¢n</a>
      <a href="/logout" class="nav-tab logout-tab">ÄÄƒng xuáº¥t</a>
    </div>
  </div>

  <!-- Main Content -->
  <div class="container">
    <h1>Há»c pháº§n cá»§a {{ student_id }}</h1>

    {% if credit_summary %}
    <section class="card" style="background-color: #f0f8ff; border-left: 4px solid #4CAF50;">
      <h2>ğŸ“Š Tá»•ng quan tÃ­n chá»‰</h2>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
        <div>
          <strong>ÄÃ£ tÃ­ch lÅ©y:</strong><br>
          <span style="font-size: 1.5em; color: #4CAF50;">{{ credit_summary.earned }}</span> / {{ credit_summary.required }} tÃ­n chá»‰
        </div>
        <div>
          <strong>CÃ²n láº¡i:</strong><br>
          <span style="font-size: 1.5em; color: #ff9800;">{{ credit_summary.remaining }}</span> tÃ­n chá»‰
        </div>
        <div>
          <strong>Tiáº¿n Ä‘á»™:</strong><br>
          <span style="font-size: 1.5em; color: #2196F3;">{{ credit_summary.percentage }}%</span>
        </div>
      </div>
      <p style="margin-top: 1rem; color: #666; font-size: 0.9em;">
        <em>Má»¥c tiÃªu: HoÃ n thÃ nh 156 tÃ­n chá»‰ trong 4.5 nÄƒm (9 há»c ká»³) - Trung bÃ¬nh ~17.3 tÃ­n chá»‰/há»c ká»³</em>
      </p>
    </section>
    {% endif %}

    <section class="card">
      <h2>MÃ´n Ä‘Ã£ há»c / tiáº¿n trÃ¬nh</h2>
      {% if courses %}
      <table>
        <thead>
          <tr><th>MÃ£ mÃ´n</th><th>TÃªn mÃ´n há»c</th><th>NÄƒm</th><th>Há»c ká»³</th><th>Sá»‘ tÃ­n chá»‰</th><th>Tráº¡ng thÃ¡i</th><th>Äiá»ƒm</th></tr>
        </thead>
        <tbody>
          {% for c in courses %}
          <tr>
            <td>{{ c.CourseCode }}</td>
            <td>{{ c.CourseName }}</td>
            <td>{{ c.Year }}</td>
            <td>{{ c.Semester }}</td>
            <td>{{ c.Credits }}</td>
            <td>{{ c.Status }}</td>
            <td>{{ c.Score }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
        <p class="muted">KhÃ´ng tÃ¬m tháº¥y dá»¯ liá»‡u há»c pháº§n cho sinh viÃªn nÃ y.</p>
      {% endif %}
    </section>

    {# TÃ¡ch thÃ nh cÃ¡c nhÃ³m #}
    {% if recs %}
      {% set thesis_recs = [] %}
      {% set additional_recs = [] %}
      {% set other_recs = [] %}
      {% for r in recs %}
        {% if (r.get('CourseCode') == 'CT555') and (r.get('recommended_year') == 5) and (r.get('recommended_semester') == 1) %}
          {% if thesis_recs.append(r) %}{% endif %}
        {% elif (r.get('recommended_year') == 5) and (r.get('recommended_semester') == 1) and (r.get('CourseCode') != 'CT555') %}
          {% if additional_recs.append(r) %}{% endif %}
        {% else %}
          {% if other_recs.append(r) %}{% endif %}
        {% endif %}
      {% endfor %}
    {% else %}
      {% set thesis_recs = [] %}
      {% set additional_recs = [] %}
      {% set other_recs = [] %}
    {% endif %}

    {% if thesis_recs %}
    <section class="card">
      <h2>ğŸ“ Gá»£i Ã½ luáº­n vÄƒn tá»‘t nghiá»‡p (Há»c ká»³ 1 nÄƒm 5)</h2>
      <p style="color: #666; font-size: 0.9em; margin-bottom: 1em;">
        <em>Gá»£i Ã½ cho sinh viÃªn Ä‘Ã£ gáº§n Ä‘á»§ 156 tÃ­n chá»‰ - chá»‰ cáº§n thÃªm luáº­n vÄƒn tá»‘t nghiá»‡p</em>
      </p>
      <table>
        <thead>
          <tr>
            <th>MÃ£ mÃ´n</th>
            <th>TÃªn mÃ´n há»c</th>
            <th>TÃ­n chá»‰</th>
            <th>NÄƒm há»c</th>
            <th>Há»c ká»³</th>
            <th>Äiá»ƒm TB</th>
            <th>Tá»· lá»‡ Ä‘áº­u</th>
            <th>LÃ½ do gá»£i Ã½</th>
          </tr>
        </thead>
        <tbody>
          {% for r in thesis_recs %}
          <tr>
            <td><strong>{{ r.CourseCode }}</strong></td>
            <td>{{ r.CourseName }}</td>
            <td>{{ r.Credits }}</td>
            <td><strong>NÄƒm {{ r.recommended_year }}</strong></td>
            <td><strong>HK{{ r.recommended_semester }}</strong></td>
            <td>
              {% if r.avg_score %}
                {{ "%.2f"|format(r.avg_score) }}
              {% else %}
                -
              {% endif %}
            </td>
            <td>
              {% if r.pass_rate %}
                {{ "%.1f"|format(r.pass_rate) }}%
              {% else %}
                -
              {% endif %}
            </td>
            <td style="font-size: 0.9em; color: #555;">
              {% if r.recommendation_reason %}
                {{ r.recommendation_reason }}
              {% else %}
                Gá»£i Ã½ dá»±a trÃªn sinh viÃªn tÆ°Æ¡ng tá»±
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </section>
    {% endif %}

    {% if additional_recs %}
    <section class="card">
      <h2>ğŸ“š Gá»£i Ã½ cÃ¡c mÃ´n bá»• sung (Há»c ká»³ 1 nÄƒm 5)</h2>
      <p style="color: #666; font-size: 0.9em; margin-bottom: 1em;">
        <em>Pháº§n nÃ y Ä‘Ã£ Ä‘Æ°á»£c chuyá»ƒn sang trang riÃªng.</em>
      </p>
      <p>
        <a class="button" href="/recommendations/hk1-nam5">Xem cÃ¡c mÃ´n bá»• sung cho HK1 NÄƒm 5 â†’</a>
      </p>
    </section>
    {% endif %}

    {% if other_recs %}
    <section class="card">
      <h2>ğŸ“– Gá»£i Ã½ há»c pháº§n tiáº¿p theo</h2>
      <p style="color: #666; font-size: 0.9em; margin-bottom: 1em;">
        <em>Gá»£i Ã½ dá»±a trÃªn lá»‹ch sá»­ há»c táº­p cá»§a cÃ¡c sinh viÃªn Ä‘Ã£ tá»‘t nghiá»‡p Ä‘Ãºng háº¡n</em>
      </p>
      <table>
        <thead>
          <tr>
            <th>MÃ£ mÃ´n</th>
            <th>TÃªn mÃ´n há»c</th>
            <th>TÃ­n chá»‰</th>
            <th>NÄƒm há»c</th>
            <th>Há»c ká»³</th>
            <th>Äiá»ƒm TB</th>
            <th>Tá»· lá»‡ Ä‘áº­u</th>
            <th>LÃ½ do gá»£i Ã½</th>
          </tr>
        </thead>
        <tbody>
          {% for r in other_recs %}
          <tr>
            <td><strong>{{ r.CourseCode }}</strong></td>
            <td>{{ r.CourseName }}</td>
            <td>{{ r.Credits }}</td>
            <td>
              {% if r.recommended_year %}
                <strong>NÄƒm {{ r.recommended_year }}</strong>
              {% else %}
                -
              {% endif %}
            </td>
            <td>
              {% if r.recommended_semester %}
                <strong>HK{{ r.recommended_semester }}</strong>
              {% else %}
                -
              {% endif %}
            </td>
            <td>
              {% if r.avg_score %}
                {{ "%.2f"|format(r.avg_score) }}
              {% else %}
                -
              {% endif %}
            </td>
            <td>
              {% if r.pass_rate %}
                {{ "%.1f"|format(r.pass_rate) }}%
              {% else %}
                -
              {% endif %}
            </td>
            <td style="font-size: 0.9em; color: #555;">
              {% if r.recommendation_reason %}
                {{ r.recommendation_reason }}
              {% elif r.frequency %}
                ÄÆ°á»£c há»c bá»Ÿi {{ r.frequency }} sinh viÃªn tá»‘t nghiá»‡p Ä‘Ãºng háº¡n tÆ°Æ¡ng tá»±
              {% else %}
                Gá»£i Ã½ dá»±a trÃªn sinh viÃªn tÆ°Æ¡ng tá»±
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </section>
    {% endif %}

    {% if not recs or (not thesis_recs and not additional_recs and not other_recs) %}
    <section class="card">
      <h2>Gá»£i Ã½ há»c pháº§n tiáº¿p theo</h2>
      <p class="muted">KhÃ´ng cÃ³ gá»£i Ã½ nÃ o cho ká»³ tiáº¿p theo hoáº·c chÆ°a Ä‘á»§ dá»¯ liá»‡u.</p>
    </section>
    {% endif %}
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-content">
      <p><strong>TrÆ°á»ng Äáº¡i há»c Cáº§n ThÆ¡ (Can Tho University)</strong></p>
      <p>Khu II, Ä‘Æ°á»ng 3/2, P. XuÃ¢n KhÃ¡nh, Q. Ninh Kiá»u, TP. Cáº§n ThÆ¡.</p>
      <p>Äiá»‡n thoáº¡i: (84-292) 3832663 - (84-292) 3838474; Fax: (84-292) 3838474; Email: dhct@ctu.edu.vn.</p>
    </div>
  </footer>
</body>
</html>
